const y=(v,t)=>new Promise(l=>{let i=t.querySelector(v);i?l(i):new MutationObserver((r,e)=>{Array.from(t.querySelectorAll(v)).forEach(s=>{l(s),e.disconnect()})}).observe(t,{childList:!0,subtree:!0})}),S={trailing:!0},D="/pdfjs",C="/web/viewer.html",A="",P="",k="",R="",V="",F="none",O="",L="",j="",I="",q="",M="",W="",z="",x="AUTOMATIC",$="",H="",N="",b={AUTOMATIC:0,LIGHT:1,DARK:2},E=["src","viewer-path","disable-worker","text-layer","disable-font-face","disable-range","disable-stream","disable-auto-fetch","verbosity","locale","viewer-css-theme","viewer-extra-styles","viewer-extra-styles-urls"];class p extends HTMLElement{constructor(){super(),this.onIframeReady=function(i,r=25,e={}){if(e={...S,...e},!Number.isFinite(r))throw new TypeError("Expected `wait` to be a finite number");let s,n,a,o,h=[];const f=(d,u)=>(a=async function(c,m,w){return await c.apply(m,w)}(i,d,u),a.finally(()=>{if(a=null,e.trailing&&o&&!n){const c=f(d,o);return o=null,c}}),a);return function(...d){return a?(e.trailing&&(o=d),a):new Promise(u=>{const c=!n&&e.leading;clearTimeout(n),n=setTimeout(()=>{n=null;const m=e.leading?s:f(this,d);for(const w of h)w(m);h=[]},r),c?(s=f(this,d),u(s)):h.push(u)})}}(async i=>{await y("iframe",this.shadowRoot),i()},0,{leading:!0}),this.setViewerExtraStyles=(i,r="extra")=>{var e,s,n,a,o;if(!i)return void((s=(e=this.iframe.contentDocument)==null?void 0:e.head.querySelector(`style[${r}]`))==null?void 0:s.remove());if(((a=(n=this.iframe.contentDocument)==null?void 0:n.head.querySelector(`style[${r}]`))==null?void 0:a.innerHTML)===i)return;const h=document.createElement("style");h.innerHTML=i,h.setAttribute(r,""),(o=this.iframe.contentDocument)==null||o.head.appendChild(h)},this.injectExtraStylesLinks=i=>{i&&i.replace(/'|]|\[/g,"").split(",").map(r=>r.trim()).forEach(r=>{var e,s;if((e=this.iframe.contentDocument)==null?void 0:e.head.querySelector(`link[href="${r}"]`))return;const n=document.createElement("link");n.rel="stylesheet",n.href=r,(s=this.iframe.contentDocument)==null||s.head.appendChild(n)})},this.initialize=()=>new Promise(async i=>{var r;await y("iframe",this.shadowRoot),(r=this.iframe)==null||r.addEventListener("load",async()=>{var e,s,n;await((s=(e=this.iframe.contentWindow)==null?void 0:e.PDFViewerApplication)==null?void 0:s.initializedPromise),i((n=this.iframe.contentWindow)==null?void 0:n.PDFViewerApplication)},{once:!0})});const t=this.attachShadow({mode:"open"}),l=document.createElement("template");l.innerHTML=`
      <style>:host{width:100%;display:block;overflow:hidden}:host iframe{height:100%}</style>
      <iframe frameborder="0" width="100%" loading="lazy"></iframe>
    `,t.appendChild(l.content.cloneNode(!0))}static get observedAttributes(){return["src","viewer-path","page","search","phrase","zoom","pagemode","disable-worker","text-layer","disable-font-face","disable-range","disable-stream","disable-auto-fetch","verbosity","locale","viewer-css-theme","viewer-extra-styles","viewer-extra-styles-urls","nameddest"]}connectedCallback(){this.iframe=this.shadowRoot.querySelector("iframe"),document.addEventListener("webviewerloaded",async()=>{var t,l,i,r,e,s,n,a;this.setCssTheme(this.getCssThemeOption()),this.injectExtraStylesLinks(this.getAttribute("viewer-extra-styles-urls")??H),this.setViewerExtraStyles(this.getAttribute("viewer-extra-styles")??$),this.getAttribute("src")!==A&&((l=(t=this.iframe.contentWindow)==null?void 0:t.PDFViewerApplicationOptions)==null||l.set("defaultUrl","")),(r=(i=this.iframe.contentWindow)==null?void 0:i.PDFViewerApplicationOptions)==null||r.set("disablePreferences",!0),(s=(e=this.iframe.contentWindow)==null?void 0:e.PDFViewerApplicationOptions)==null||s.set("pdfBugEnabled",!0),(a=(n=this.iframe.contentWindow)==null?void 0:n.PDFViewerApplicationOptions)==null||a.set("eventBusDispatchToDOM",!0)})}attributeChangedCallback(t){E.includes(t)?this.onIframeReady(()=>this.mountViewer(this.getIframeSrc())):this.onIframeReady(()=>{this.iframe.src=this.getIframeSrc()})}getIframeSrc(){const t=this.getFullPath(this.getAttribute("src")||A),l=this.getFullPath(this.getAttribute("viewer-path")||D),i=this.getAttribute("page")||P,r=this.getAttribute("search")||k,e=this.getAttribute("phrase")||R,s=this.getAttribute("zoom")||V,n=this.getAttribute("pagemode")||F,a=this.getAttribute("disable-worker")||L,o=this.getAttribute("text-layer")||j,h=this.getAttribute("disable-font-face")||I,f=this.getAttribute("disable-range")||q,d=this.getAttribute("disable-stream")||M,u=this.getAttribute("disable-auto-fetch")||W,c=this.getAttribute("verbosity")||z,m=this.getAttribute("locale")||O,w=this.getAttribute("viewer-css-theme")||x,T=!!(this.getAttribute("viewer-extra-styles")||$),g=this.getAttribute("nameddest")||N;return`
${l}${C}?file=
${encodeURIComponent(t)}#page=${i}&zoom=${s}&pagemode=${n}&search=${r}&phrase=${e}&textLayer=
${o}&disableWorker=
${a}&disableFontFace=
${h}&disableRange=
${f}&disableStream=
${d}&disableAutoFetch=
${u}&verbosity=
${c}
${m?"&locale="+m:""}&viewerCssTheme=
${w}&viewerExtraStyles=
${T}
${g?"&nameddest="+g:""}`}mountViewer(t){t&&this.iframe&&(this.shadowRoot.replaceChild(this.iframe.cloneNode(),this.iframe),this.iframe=this.shadowRoot.querySelector("iframe"),this.iframe.src=t)}getFullPath(t){return t.startsWith("/")?`${window.location.origin}${t}`:t}getCssThemeOption(){const t=this.getAttribute("viewer-css-theme");return Object.keys(b).includes(t)?b[t]:b[x]}setCssTheme(t){var l,i,r;if(t===b.DARK){const e=(l=this.iframe.contentDocument)==null?void 0:l.styleSheets[0],s=(e==null?void 0:e.cssRules)||[],n=Object.keys(s).filter(a=>{var o;return((o=s[Number(a)])==null?void 0:o.conditionText)==="(prefers-color-scheme: dark)"}).map(a=>s[Number(a)].cssText.split(`@media (prefers-color-scheme: dark) {
`)[1].split(`
}`)[0]);this.setViewerExtraStyles(n.join(""),"theme")}else(r=(i=this.iframe.contentDocument)==null?void 0:i.head.querySelector("style[theme]"))==null||r.remove()}}window.customElements.get("pdfjs-viewer-element")||(window.PdfjsViewerElement=p,window.customElements.define("pdfjs-viewer-element",p));export default p;export{p as PdfjsViewerElement,b as ViewerCssTheme,E as hardRefreshAttributes};
